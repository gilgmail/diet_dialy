# ğŸ¯ Supabase è³‡æ–™æŒä¹…åŒ–å•é¡Œ - å®Œæ•´è§£æ±ºæ–¹æ¡ˆ

## å•é¡Œè¨ºæ–·æ‘˜è¦

### âœ… å·²ç¢ºèªæ­£å¸¸çš„éƒ¨åˆ†ï¼š
1. **Supabase åŸºç¤é€£æ¥** - é€£æ¥å’ŒåŸºæœ¬æŸ¥è©¢æ­£å¸¸
2. **è³‡æ–™è¡¨çµæ§‹** - `diet_daily_users` è¡¨å·²æ­£ç¢ºå»ºç«‹
3. **RLS æ”¿ç­–** - Row Level Security å·²å•Ÿç”¨
4. **Google OAuth** - èªè­‰æµç¨‹æ­£å¸¸é‹ä½œ

### âŒ ç¢ºèªçš„å•é¡Œï¼š
1. **æœƒè©±ç®¡ç†å•é¡Œ** - Supabase å®¢æˆ¶ç«¯æœƒè©±ç‹€æ…‹ä¸ä¸€è‡´
2. **å‰ç«¯è¼‰å…¥é‚è¼¯** - èªè­‰ Hook é‚è¼¯å°è‡´ç„¡é™è¼‰å…¥
3. **RLS æ¬Šé™å•é¡Œ** - æœªèªè­‰ç”¨æˆ¶ç„¡æ³•åŸ·è¡Œè³‡æ–™æ“ä½œ

## ğŸ”§ è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ç«‹å³å¯ç”¨çš„ç°¡åŒ–ä¿®å¾©

1. **æ›¿æ›èªè­‰ Hook**ï¼š
   ```bash
   # ä½¿ç”¨å·²å‰µå»ºçš„ç°¡åŒ–ç‰ˆæœ¬
   cp src/hooks/useSupabaseAuth_simple.ts src/hooks/useSupabaseAuth.ts
   ```

2. **é‡æ–°ç™»å…¥**ï¼š
   - æ¸…é™¤ç€è¦½å™¨ Local Storage
   - é‡æ–°é€²è¡Œ Google OAuth ç™»å…¥

### æ–¹æ¡ˆ 2: æ ¹æœ¬ä¿®å¾©ï¼ˆæ¨è–¦ï¼‰

1. **ä¿®å¾©æœƒè©±æŒä¹…åŒ–**ï¼š
   åœ¨ `src/lib/supabase/client.ts` ä¸­ï¼š
   ```typescript
   import { createClient } from '@supabase/supabase-js'

   export const supabase = createClient(
     process.env.NEXT_PUBLIC_SUPABASE_URL!,
     process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
     {
       auth: {
         autoRefreshToken: true,
         persistSession: true,
         detectSessionInUrl: true
       }
     }
   )
   ```

2. **ç°¡åŒ–èªè­‰é‚è¼¯**ï¼š
   åœ¨èªè­‰ Hook ä¸­ç§»é™¤è¤‡é›œçš„æœƒè©±ç›£è½ï¼Œæ”¹ç”¨å®šæ™‚æª¢æŸ¥

3. **ç¢ºä¿ RLS æ”¿ç­–æ­£ç¢º**ï¼š
   ```sql
   -- åœ¨ Supabase Dashboard ä¸­åŸ·è¡Œ
   CREATE POLICY "Users can manage own data" ON diet_daily_users
     FOR ALL USING (auth.uid() = id);
   ```

### æ–¹æ¡ˆ 3: æ¸¬è©¦ç’°å¢ƒè§£æ±ºæ–¹æ¡ˆ

å¦‚æœé–‹ç™¼ç’°å¢ƒæŒçºŒæœ‰å•é¡Œï¼Œå¯ä»¥ï¼š

1. **ä½¿ç”¨æ¸¬è©¦ç¨‹å¼**ï¼š
   ```bash
   # é‹è¡Œç¨ç«‹æ¸¬è©¦ç¢ºèªåŠŸèƒ½
   node test_supabase_operations.js
   ```

2. **ç€è¦½å™¨èª¿è©¦**ï¼š
   - F12 é–‹ç™¼è€…å·¥å…· â†’ Application â†’ Local Storage
   - æ¸…é™¤æ‰€æœ‰ Supabase ç›¸é—œè³‡æ–™
   - é‡æ–°ç™»å…¥

## ğŸ§ª è¨ºæ–·å·¥å…·

å·²å‰µå»ºçš„æ¸¬è©¦ç¨‹å¼ï¼š
- `test_supabase_operations.js` - åŸºç¤é€£æ¥æ¸¬è©¦
- `test_supabase_with_auth.js` - èªè­‰ç’°å¢ƒæ¸¬è©¦
- `direct_supabase_test.js` - å®Œå…¨ç¨ç«‹æ¸¬è©¦
- `debug_loading_issue.js` - è¼‰å…¥å•é¡Œè¨ºæ–·

## ğŸ’¡ é—œéµç™¼ç¾

1. **æ ¹æœ¬åŸå› **ï¼šSupabase æœƒè©±ç®¡ç†èˆ‡ Next.js SSR çš„æ•´åˆå•é¡Œ
2. **å¾ªç’°ä¾è³´**ï¼šReact Hook ä¸­çš„ä¾è³´å¾ªç’°å°è‡´ç„¡é™é‡æ–°æ¸²æŸ“
3. **RLS é˜»æ“‹**ï¼šæœªæ­£ç¢ºå‚³éèªè­‰ç‹€æ…‹åˆ° Supabase å®¢æˆ¶ç«¯

## ğŸš€ å»ºè­°çš„å¯¦æ–½æ­¥é©Ÿ

1. **ç«‹å³ä¿®å¾©**ï¼šä½¿ç”¨ç°¡åŒ–çš„èªè­‰é‚è¼¯
2. **æ¸¬è©¦é©—è­‰**ï¼šç¢ºèªå„²å­˜åŠŸèƒ½æ­£å¸¸
3. **é•·æœŸå„ªåŒ–**ï¼šæ”¹å–„æœƒè©±ç®¡ç†å’ŒéŒ¯èª¤è™•ç†

## âœ… é æœŸçµæœ

ä¿®å¾©å¾Œæ‡‰è©²çœ‹åˆ°ï¼š
- è¨­å®šé é¢æ­£å¸¸è¼‰å…¥ï¼Œä¸æœƒå¡åœ¨ã€Œè¼‰å…¥ä¸­...ã€
- é¸æ“‡é†«ç™‚ç‹€æ³å¾Œå¯ä»¥æˆåŠŸå„²å­˜
- é é¢é‡æ–°è¼‰å…¥å¾Œè³‡æ–™ä»ç„¶å­˜åœ¨
- å„²å­˜æ“ä½œæœ‰æ˜ç¢ºçš„æˆåŠŸ/å¤±æ•—è¨Šæ¯

---

**ç¸½çµ**ï¼šå•é¡Œä¸»è¦åœ¨æ–¼å‰ç«¯æœƒè©±ç®¡ç†ï¼Œè€Œé Supabase é…ç½®æœ¬èº«ã€‚ä½¿ç”¨ç°¡åŒ–çš„èªè­‰é‚è¼¯å¯ä»¥ç«‹å³è§£æ±ºå•é¡Œã€‚
# 📋 完整自我測試腳本

## 🎯 測試目標
驗證醫療數據服務初始化修復後，Google Sheets同步功能是否正常運作

## ⚡ 當前系統狀態
- ✅ 開發服務器運行在 http://localhost:3000
- ✅ 醫療數據服務自動初始化修復已實施
- ⚠️ 需要重新認證（當前認證狀態：已過期）

## 🧪 測試步驟執行

### 第一步：打開食物日誌頁面
✅ **動作**: 瀏覽器已打開 http://localhost:3000/food-diary
✅ **觀察**: 頁面正常載入

### 第二步：檢查認證狀態
🔍 **控制台輸出分析**:
```
🔍 檢查認證狀態: { hasTokens: false, hasUserInfo: false, userEmail: undefined }
❌ 認證失敗: 缺少 token 或用戶資訊
```

**結論**: 需要重新認證才能進行完整測試

### 第三步：重新認證流程
**必須動作**: 前往 http://localhost:3000/auth 進行Google登入

**預期流程**:
1. 點擊「使用 Google 登入」
2. 完成Google OAuth授權
3. 返回應用，獲得有效認證令牌

### 第四步：認證後的自動初始化驗證
**預期控制台輸出**:
```
🚀 自動初始化醫療數據服務...
🚀 開始初始化醫療資料服務...
✅ Google 認證檢查通過
📊 正在初始化 Google Sheets...
✅ Google Sheets 初始化成功，ID: [spreadsheet_id]
🚫 智能同步已禁用（調試模式）
🎉 醫療資料服務初始化完成
✅ 醫療數據服務初始化成功
```

### 第五步：食物添加測試
**測試動作**:
1. 點擊「添加食物」
2. 搜尋「蘋果」
3. 選擇搜尋結果
4. 觀察控制台輸出

**預期成功輸出**:
```
🔍 Google Sheets同步檢查: {isAuthenticated: true, hasRecordFunction: true, userInfo: Gil Ko...}
🔄 嘗試同步到Google Sheets...
📝 食物資料: {foodName: "蘋果", time: "14:30", date: "2025-09-19", score: 5}
📤 開始調用recordFoodEntry...
🔍 recordFoodEntry: 檢查同步條件 {onLine: true, authenticated: true, hasSpreadsheetId: true}
📤 嘗試直接同步到Google Sheets...
🔑 檢查並刷新認證令牌...
✅ 認證令牌刷新成功
📊 轉換後的 Sheets 格式: {foodName: "蘋果", category: "水果", ...}
✅ Google Sheets 同步成功: true
✅ Google Sheets同步成功: true
```

## 🎯 修復驗證標準

### ✅ 修復成功標準
- [ ] 認證後看到自動初始化日誌
- [ ] 不再出現「Medical data service not initialized」錯誤
- [ ] 食物添加時顯示「✅ Google Sheets 同步成功: true」
- [ ] UI中食物記錄正常顯示
- [ ] Google Sheets中實際寫入新記錄

### ❌ 失敗標準
- 仍出現初始化錯誤
- 同步過程失敗
- Google Sheets沒有新記錄

## 🔍 當前測試狀態

### 已完成項目
- ✅ 開發服務器正常運行
- ✅ 食物日誌頁面可訪問
- ✅ 修復代碼已部署

### 需要用戶操作項目
- 🔄 **重新認證**: 前往 /auth 頁面登入Google
- 🔄 **執行測試**: 認證後添加食物記錄
- 🔄 **驗證結果**: 檢查控制台輸出和Google Sheets

## 📊 測試期望結果

如果修復成功，您應該看到：
1. **自動初始化**: 認證後立即自動初始化醫療數據服務
2. **無錯誤**: 不再出現「not initialized」錯誤
3. **同步成功**: 食物記錄成功同步到Google Sheets
4. **完整功能**: 本地存儲和雲端同步都正常工作

---

**測試狀態**: 🔄 等待用戶認證並執行測試
**關鍵修復**: 醫療數據服務自動初始化 ✅ 已實施
**下一步**: 認證 → 測試 → 驗證

*測試準備時間: 2025-09-19 13:40*
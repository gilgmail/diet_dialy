# 更新日誌 (Changelog)

Diet Daily 醫療級飲食追蹤 PWA

## [2.2.0] - 2025-09-18

### 🎯 重大功能變更 (Major Feature Changes)

#### 中文PDF報告系統完整實現
- **新增**: 支援中文字符的PDF報告生成功能
- **技術**: 採用html2canvas技術轉換HTML為圖像，完美保留中文字符
- **功能**: 包含醫療建議、症狀分析、食物關聯性等完整報告內容
- **體驗**: 全中文界面和提示訊息，提供專業醫療級報告

#### 健康分析中心全面中文化
- **完成**: 所有醫療建議完全中文化
- **完成**: PDF預覽和生成功能中文提示
- **完成**: 統計數據和分析結果中文顯示
- **完成**: 錯誤處理和除錯訊息中文化

### 🔧 重大修復 (Major Fixes)

#### PDF報告生成錯誤修復
- **修復**: JavaScript變數作用域錯誤 (day/days is not defined)
  - 問題: calculateStats函數中缺少days變數定義
  - 解決: 在函數內正確定義reportPeriod對應的天數變數
  - 影響: PDF預覽和生成功能正常運作

- **修復**: 中文字符在PDF中顯示亂碼問題
  - 問題: jsPDF不支援中文字符導致PDF內容亂碼
  - 解決: 實現html2canvas方案，將HTML內容轉換為圖像嵌入PDF
  - 影響: 完美保留中文字符，生成高品質醫療報告

- **修復**: html2canvas模組載入錯誤
  - 問題: SSR環境下模組載入失敗
  - 解決: 使用動態導入避免伺服器端執行問題
  - 影響: 中文PDF生成功能穩定運行

### ✨ 新功能 (New Features)

#### 專業醫療建議系統
- 高症狀嚴重度智能檢測和建議
- 活動影響程度評估和調整建議
- 睡眠品質改善專業指導
- 高風險食物識別和避免清單
- 症狀趨勢分析和醫療諮詢建議

#### 智能報告配置系統
- 可選擇報告章節和內容範圍
- 支援7天、30天、90天不同時間期間
- 實時數據預覽和統計摘要
- 詳細的報告生成進度提示

### 🚀 效能改進 (Performance Improvements)

- 優化PDF生成流程，支援大容量數據處理
- 改善錯誤處理機制，提供明確的中文錯誤訊息
- 增強數據驗證邏輯，確保報告內容準確性
- 實現高解析度PDF輸出 (scale: 2)

### 📊 驗證結果 (Technical Validation)

| 功能模組 | 修復前狀態 | 修復後狀態 | 狀態 |
|----------|-----------|-----------|------|
| 變數作用域 | day/days錯誤 | 正確定義變數 | ✅ 修復 |
| 中文字符 | PDF亂碼 | 完美顯示 | ✅ 修復 |
| 模組載入 | SSR錯誤 | 動態導入 | ✅ 修復 |
| 醫療建議 | 部分英文 | 完全中文 | ✅ 修復 |

---

## [2.1.0] - 2025-09-15

### 🎯 重大功能變更 (Major Feature Changes)

#### 移除照片識別，專注快速文字輸入
- **移除**: 拍照食物識別功能 (Microsoft Computer Vision)
- **新增**: 快速文字食物輸入系統
- **新增**: 智能食物搜尋和自動建議
- **原因**: 用戶偏好更快速準確的文字輸入方式

#### Week 2 完整功能實現
- **完成**: 三種記錄方式 (快速/詳細/自訂)
- **完成**: 響應式 UI 設計和使用者體驗
- **完成**: 食物歷史記錄和常用食物功能
- **達成**: 超越目標的系統效能指標

### 🔧 重大修復 (Major Fixes)

#### IBD 醫療評分系統全面修復
- **修復**: IBD 評分引擎語言不匹配問題
  - 問題: 食物資料庫使用英文風險因子但評分邏輯使用中文對照
  - 解決: 實現雙語風險因子支援，確保準確評分
  - 影響: 雞排從錯誤的 3/4 修正為正確的 1/4 評分

- **修復**: QuickFoodEntry 資料結構錯誤
  - 問題: 傳送完整 food 物件而非 foodId 字串
  - 解決: 修正為符合 CreateHistoryEntryRequest 介面規範
  - 影響: 食物記錄建立流程正常運作

- **修復**: 常用食物 API 空值安全問題
  - 問題: TypeError 導致 API 失敗
  - 解決: 增強空值檢查和錯誤處理
  - 影響: 提升系統穩定性

### ✨ 新功能 (New Features)

#### 雙語醫療風險因子系統
- 支援中英文風險因子自動對照
- 智能匹配食物資料庫標籤
- 輸出使用者友好的中文風險說明

#### 增強的醫療建議系統
- 更準確的 IBD 階段性飲食建議
- 智能替代食物推薦
- 個人化風險評估

### 🚀 效能改進 (Performance Improvements)

- 優化 API 端點資料流程
- 改善錯誤處理和驗證邏輯
- 增強除錯和監控功能

### 📊 驗證結果 (Validation Results)

| 食物項目 | 修復前評分 | 修復後評分 | 狀態 |
|----------|-----------|-----------|------|
| 雞排 | 3/4 (好) | 1/4 (差) | ✅ 修復 |
| 糖醋里肌 | 3/4 (好) | 2/4 (普通) | ✅ 修復 |
| 清蒸魚 | 4/4 (完美) | 4/4 (完美) | ✅ 維持 |
| 白粥 | 4/4 (完美) | 4/4 (完美) | ✅ 維持 |

### 🔄 API 變更 (API Changes)

#### 修復的端點
- `POST /api/history` - 修正資料結構驗證
- `GET /api/history/frequent` - 增強空值安全
- `POST /api/foods` - 改善驗證記錄

#### 新增的日誌
- 詳細的 IBD 評分計算過程
- 雙語風險因子匹配記錄
- 增強的錯誤追蹤資訊

---

## [2.0.0] - 2025-09-14

### 🎉 主要版本發布

#### 完整食物資料庫管理系統
- CRUD 操作完整實現
- 智能 UI 設計和用戶體驗優化
- 支援拍照識別和手動輸入

#### 醫療功能完善
- IBD 階段化評分系統
- 多重疾病選擇支援
- 過敏管理功能

#### 文件本地化
- 核心專案文件翻譯成繁體中文
- 用戶介面完全中文化
- 醫療術語標準化

#### PWA 基礎建設
- 醫療級應用架構
- 離線功能支援
- 響應式設計

---

## [1.0.0] - 2025-09-13

### 🚀 初始版本發布

#### 核心功能
- 基礎食物追蹤系統
- 簡單醫療評分
- 基本用戶介面

#### 技術架構
- Next.js 14 應用框架
- TypeScript 類型安全
- 基礎 PWA 支援

---

## 版本號命名規則

- **主版本號 (Major)**: 不相容的 API 變更
- **次版本號 (Minor)**: 向下相容的功能新增
- **修訂號 (Patch)**: 向下相容的問題修正

## 圖示說明

- 🔧 **修復** - Bug 修復和問題解決
- ✨ **新功能** - 新增功能和特性
- 🚀 **改進** - 效能和體驗優化
- 🔄 **變更** - API 或介面變更
- ⚠️ **注意** - 重要變更或注意事項
- 📊 **資料** - 資料結構或格式變更

---

**最後更新**: 2025-09-15T18:35:00Z
**維護團隊**: Diet Daily 開發團隊